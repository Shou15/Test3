@page "/payments/{UserId}"
@rendermode InteractiveServer
@inject NavigationManager Navigation

<PageTitle>Landlord Payment Tracker</PageTitle>

<div class="container">
    <button class="back_btn" @onclick="BackBtn">Back to Dashboard</button>
    <div class="header-section">
        <h2>BILL FOR NEXT MONTH</h2>
        <div class="info-grid">
            <div class="info-row">
                <label>Room:</label>
                <input type="text" @bind="Room" />
            </div>
            <div class="info-row">
                <label>Water:</label>
                <input type="text" @bind="Water" />
            </div>
            <div class="info-row">
                <label>Electricity:</label>
                <input type="text" @bind="Electricity" />
            </div>
            <div class="info-row right-column">
                <label>Next Month Payment:</label>
                <input type="date" @bind="NextMonthPayment" />
            </div>
            <div class="info-row right-column">
                <label>Total Payment:</label>
                <input type="text" @bind="TotalPayment" readonly />
            </div>
        </div>
    </div>

    <div class="payment-section">
        <h2>PAYMENT</h2>
        <div class="payment-form">
            <div class="form-group">
                <label>Amount:</label>
                <input type="number" @bind="PaymentAmount" step="0.01" />
            </div>
            <div class="form-group">
                <label>Payment Method:</label>
                <select @bind="PaymentMethod" class="payment-method-select">
                    <option value="">Select method...</option>
                    <option value="GCASH">GCash</option>
                    <option value="CASH">Cash</option>
                    <option value="DEBIT CARD">Debit Card</option>
                    <option value="CREDIT CARD">Credit Card</option>
                </select>
            </div>
        </div>
        <button class="submit-btn" @onclick="SubmitPayment">Submit payment</button>
    </div>

    <div class="history-section">
        <h2>Payment History</h2>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Amount</th>
                    <th>Method</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var payment in PaymentHistory)
                {
                    <tr>
                        <td>@payment.Date.ToString("MM/dd/yyyy")</td>
                        <td>â‚± @payment.Amount.ToString("N2")</td>
                        <td>@payment.Method</td>
                        <td><span class="status-badge">@payment.Status</span></td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter]
    public string UserId { get; set; } = string.Empty;

    private string Room { get; set; } = "";
    private string Water { get; set; } = "";
    private string Electricity { get; set; } = "";
    private DateTime NextMonthPayment { get; set; } = DateTime.Now.AddMonths(1);
    private string TotalPayment { get; set; } = "";

    private decimal PaymentAmount { get; set; }
    private string PaymentMethod { get; set; } = "";

    private List<Payment> PaymentHistory { get; set; } = new();

    private void SubmitPayment()
    {
        if (PaymentAmount > 0 && !string.IsNullOrEmpty(PaymentMethod))
        {
            PaymentHistory.Insert(0, new Payment
            {
                Date = DateTime.Now,
                Amount = PaymentAmount,
                Method = PaymentMethod,
                Status = "COMPLETED"
            });

            PaymentAmount = 0;
            PaymentMethod = "";
        }
    }
    void BackBtn()
    {
        Navigation.NavigateTo($"/dashboard/{UserId}");
    }
    public class Payment
    {
        public DateTime Date { get; set; }
        public decimal Amount { get; set; }
        public string Method { get; set; } = "";
        public string Status { get; set; } = "";
    }
}
